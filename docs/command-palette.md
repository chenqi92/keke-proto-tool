# 命令面板 (Command Palette)

命令面板是 ProtoTool 的核心功能之一，提供快速访问所有应用功能的统一入口。

## 功能特性

### 1. 快速访问
- **快捷键**: `Ctrl+K` 或通过工具栏的"控制面板"按钮打开
- **菜单**: 视图 > 命令面板

### 2. 智能搜索
- **模糊匹配**: 支持模糊搜索命令标题、描述和关键词
- **实时过滤**: 输入时即时显示匹配结果
- **评分排序**: 根据匹配度和使用频率智能排序

### 3. 命令分类
命令按功能分为以下类别：
- **文件**: 新建会话、打开文件、保存、导出日志等
- **编辑**: 编辑操作相关命令
- **视图**: 切换侧边栏、检查器、状态栏、缩放等
- **会话**: 连接、断开、抓包、编辑协议等
- **工具**: 工具箱、消息生成器、协议解析器等
- **设置**: 外观、网络、存储、快捷键等设置
- **帮助**: 用户指南、快捷键列表、版本说明等

### 4. 使用统计
- **最近使用**: 自动记录最近使用的命令
- **使用频率**: 根据使用频率提升命令排序
- **收藏功能**: 可标记常用命令为收藏（计划中）

### 5. 安全确认
- **危险级别**: 命令标记为安全、警告或危险
- **确认对话框**: 危险操作需要用户确认

## 使用方法

### 打开命令面板
1. 按 `Ctrl+K` 快捷键
2. 点击工具栏的"控制面板"按钮（Terminal 图标）
3. 通过菜单：视图 > 命令面板

### 搜索命令
1. 打开命令面板后，直接输入关键词
2. 使用 `↑` `↓` 方向键导航
3. 按 `Enter` 执行选中的命令
4. 按 `Esc` 关闭命令面板

### 键盘快捷键
- `↑` / `↓`: 上下导航
- `Enter`: 执行选中命令
- `Esc`: 关闭命令面板

## 预定义命令列表

### 文件操作
- **新建会话** (`Ctrl+N`): 创建新的网络会话
- **打开文件** (`Ctrl+O`): 打开文件
- **保存** (`Ctrl+S`): 保存当前内容
- **导出日志**: 导出系统日志

### 视图操作
- **切换侧边栏** (`Ctrl+B`): 显示/隐藏侧边栏
- **切换检查器**: 显示/隐藏检查器面板
- **切换状态栏**: 显示/隐藏状态栏
- **搜索** (`Ctrl+F`): 搜索内容
- **放大** (`Ctrl++`): 放大视图
- **缩小** (`Ctrl+-`): 缩小视图
- **重置缩放** (`Ctrl+0`): 重置缩放级别
- **全屏** (`F11`): 切换全屏模式

### 主题操作
- **浅色主题**: 切换到浅色主题
- **深色主题**: 切换到深色主题
- **跟随系统**: 跟随系统主题设置

### 会话操作
- **连接** (`Ctrl+Enter`): 连接到当前会话
- **断开连接**: 断开当前会话连接
- **切换抓包** (`Ctrl+R`): 开始/停止抓包
- **编辑协议**: 编辑协议规则

### 工具操作
- **打开工具箱**: 打开工具箱面板
- **消息生成器**: 打开消息生成器工具
- **协议解析器**: 打开协议解析器工具
- **CRC计算器**: 打开CRC计算器工具
- **时间戳转换器**: 打开时间戳转换器工具

### 设置操作
- **打开设置**: 打开设置面板
- **外观设置**: 打开外观设置
- **网络设置**: 打开网络设置
- **存储设置**: 打开存储设置
- **快捷键设置**: 打开快捷键设置

### 帮助操作
- **用户指南**: 打开用户指南
- **键盘快捷键**: 查看键盘快捷键列表
- **版本说明**: 查看版本更新说明
- **报告问题**: 报告问题或提供反馈
- **检查更新**: 检查软件更新

## 技术实现

### 架构
```
src/services/CommandPalette/
├── types.ts                    # 类型定义
├── CommandRegistry.ts          # 命令注册表
├── CommandPaletteService.ts    # 全局服务
├── commands.ts                 # 预定义命令
└── index.ts                    # 导出入口

src/components/CommandPalette/
├── CommandPalette.tsx          # UI组件
└── index.ts                    # 导出入口

src/hooks/
└── useCommandPalette.ts        # 初始化 Hook
```

### 核心组件

#### CommandRegistry
- 命令注册和管理
- 搜索和过滤
- 使用统计
- 持久化存储

#### CommandPaletteService
- 全局事件管理
- 打开/关闭/切换命令面板

#### CommandPalette
- UI 渲染
- 键盘导航
- 搜索交互
- 确认对话框

### 扩展命令

开发者可以通过以下方式添加自定义命令：

```typescript
import { commandRegistry } from '@/services/CommandPalette';

// 注册单个命令
commandRegistry.register({
  id: 'custom.my-command',
  title: '我的自定义命令',
  category: 'tools',
  keywords: ['custom', 'my', '自定义'],
  description: '这是一个自定义命令',
  icon: MyIcon,
  shortcut: 'Ctrl+Shift+M',
  handler: () => {
    // 命令处理逻辑
    console.log('执行自定义命令');
  }
});

// 批量注册命令
commandRegistry.registerMany([
  { /* 命令1 */ },
  { /* 命令2 */ },
  // ...
]);
```

## 配置选项

命令面板支持以下配置：

```typescript
interface CommandPaletteConfig {
  maxRecentCommands: number;        // 最近命令数量 (默认: 10)
  showShortcuts: boolean;           // 显示快捷键 (默认: true)
  showIcons: boolean;               // 显示图标 (默认: true)
  groupByCategory: boolean;         // 按类别分组 (默认: true)
  boostRecentCommands: boolean;     // 提升最近命令 (默认: true)
  confirmDangerousCommands: boolean; // 确认危险命令 (默认: true)
}
```

## 数据持久化

命令面板使用 localStorage 存储以下数据：
- 命令使用统计
- 最近使用的命令
- 收藏的命令（计划中）

存储键：`prototool-command-palette-usage`

## 未来计划

- [ ] 命令收藏功能
- [ ] 命令历史记录
- [ ] 自定义快捷键
- [ ] 命令别名
- [ ] 命令参数输入
- [ ] 命令链（连续执行多个命令）
- [ ] 命令宏（录制和回放命令序列）
- [ ] 命令搜索高亮
- [ ] 命令预览
- [ ] 命令帮助文档

## 相关文档

- [CLI 设计文档](./Cli-ink-design.md) - 命令面板的设计灵感来源
- [用户指南](../public/docs/user-guide.md) - 完整的用户使用指南
- [快捷键列表](../public/docs/keyboard-shortcuts.md) - 所有快捷键列表

