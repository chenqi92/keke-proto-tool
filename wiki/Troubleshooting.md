# 故障排除

本页面提供 ProtoTool 常见问题的诊断和解决方法。

## 目录

- [应用启动问题](#应用启动问题)
- [连接问题](#连接问题)
- [协议解析问题](#协议解析问题)
- [性能问题](#性能问题)
- [数据问题](#数据问题)
- [插件问题](#插件问题)
- [日志和诊断](#日志和诊断)

## 应用启动问题

### 应用无法启动

**症状**: 双击应用图标后没有反应，或闪退

**诊断步骤**:

1. **检查系统要求**
   - Windows: Windows 10+
   - macOS: macOS 10.15+
   - Linux: GTK 3.0+

2. **查看错误日志**
   - Windows: `%APPDATA%\ProtoTool\logs\`
   - macOS: `~/Library/Application Support/ProtoTool/logs/`
   - Linux: `~/.config/ProtoTool/logs/`

3. **检查依赖**
   - Windows: 确保安装了 WebView2 Runtime
   - Linux: 确保安装了必需的系统库

**解决方法**:

```bash
# Windows - 安装 WebView2
# 下载: https://developer.microsoft.com/microsoft-edge/webview2/

# Linux - 安装依赖 (Ubuntu/Debian)
sudo apt install libwebkit2gtk-4.0-37 libgtk-3-0

# macOS - 重置权限
xattr -cr /Applications/ProtoTool.app
```

### 应用崩溃

**症状**: 应用运行中突然崩溃

**诊断步骤**:

1. **查看崩溃日志**
   - 检查 `logs/` 目录中的错误日志
   - 查看系统事件日志

2. **重现问题**
   - 记录崩溃前的操作步骤
   - 尝试重现问题

3. **检查资源使用**
   - 查看内存使用情况
   - 检查磁盘空间

**解决方法**:

1. **重置配置**
   ```bash
   # 备份配置
   # 然后删除配置目录
   # Windows: %APPDATA%\ProtoTool
   # macOS: ~/Library/Application Support/ProtoTool
   # Linux: ~/.config/ProtoTool
   ```

2. **更新到最新版本**
   - 检查是否有可用更新
   - 下载并安装最新版本

3. **报告问题**
   - 收集崩溃日志
   - 在 GitHub 提交 Issue

## 连接问题

### TCP 连接超时

**症状**: 连接一直显示"连接中"，最后超时

**诊断步骤**:

1. **测试网络连通性**
   ```bash
   # 测试主机是否可达
   ping <host>
   
   # 测试端口是否开放
   telnet <host> <port>
   # 或使用 nc
   nc -zv <host> <port>
   ```

2. **检查防火墙**
   - 确认防火墙允许出站连接
   - 检查目标服务器防火墙规则

3. **验证服务器状态**
   - 确认服务器正在运行
   - 检查服务器日志

**解决方法**:

1. **调整超时设置**
   - 设置 → 网络设置 → 连接超时
   - 增加超时时间（如 30 秒）

2. **检查代理设置**
   - 如果使用代理，确认代理配置正确
   - 尝试禁用代理

3. **使用正确的 IP 和端口**
   - 确认 IP 地址正确
   - 确认端口号正确

### UDP 无法接收数据

**症状**: UDP 连接成功，但收不到数据

**诊断步骤**:

1. **检查端口绑定**
   ```bash
   # Windows
   netstat -an | findstr <port>
   
   # Linux/macOS
   netstat -an | grep <port>
   # 或
   lsof -i :<port>
   ```

2. **测试 UDP 通信**
   ```bash
   # 发送测试数据
   echo "test" | nc -u <host> <port>
   ```

3. **检查防火墙规则**
   - 确认允许 UDP 流量
   - 检查入站规则

**解决方法**:

1. **更换端口**
   - 尝试使用其他端口
   - 避免使用被占用的端口

2. **检查网络接口**
   - 确认绑定到正确的网络接口
   - 对于组播，确认加入了正确的组

3. **调整缓冲区大小**
   - 增加接收缓冲区大小
   - 设置 → 性能设置

### WebSocket 连接失败

**症状**: WebSocket 连接失败，显示错误

**诊断步骤**:

1. **验证 URL 格式**
   - 确保使用 `ws://` 或 `wss://` 前缀
   - 检查路径是否正确

2. **测试 WebSocket 端点**
   ```bash
   # 使用 wscat 测试
   npm install -g wscat
   wscat -c ws://example.com/path
   ```

3. **检查 SSL 证书**（wss://）
   - 确认证书有效
   - 检查证书链

**解决方法**:

1. **允许自签名证书**（仅测试）
   - 设置 → 网络设置 → 允许不安全的证书

2. **检查子协议**
   - 确认子协议配置正确
   - 与服务器协商一致

3. **查看服务器日志**
   - 检查服务器端错误
   - 确认服务器支持 WebSocket

## 协议解析问题

### 协议解析失败

**症状**: 应用协议后，数据无法解析或解析错误

**诊断步骤**:

1. **验证协议文件**
   - 检查协议文件格式
   - 确认 framing 配置正确

2. **检查数据格式**
   - 确认数据符合协议规范
   - 使用十六进制查看原始数据

3. **测试协议**
   - 使用工具箱中的协议解析器测试
   - 使用已知正确的数据测试

**解决方法**:

1. **启用容错模式**
   - 在协议设置中启用容错模式
   - 查看详细错误信息

2. **修正协议定义**
   - 根据错误信息修正协议
   - 调整字段偏移和大小

3. **查看解析日志**
   - 检查日志中的详细错误
   - 根据错误调整协议

详见 [[Protocol Troubleshooting|Protocol-Troubleshooting]]。

### 协议商店无法访问

**症状**: 协议商店显示加载失败

**诊断步骤**:

1. **检查网络连接**
   ```bash
   # 测试 GitHub 连接
   ping github.com
   curl -I https://api.github.com
   ```

2. **检查 API 限制**
   - GitHub API 限制：60 次/小时（未认证）
   - 等待限制重置

3. **查看错误信息**
   - 查看浏览器控制台（F12）
   - 检查网络请求

**解决方法**:

1. **配置代理**
   - 如果在代理环境，配置代理设置
   - 设置 → 网络设置 → 代理

2. **配置 GitHub Token**（可选）
   - 生成 GitHub Personal Access Token
   - 在设置中配置 Token
   - 提高 API 限制到 5000 次/小时

3. **手动下载协议**
   - 访问 [协议商店仓库](https://github.com/chenqi92/keke-proto-tool-shop)
   - 手动下载协议文件
   - 使用"导入协议"功能

## 性能问题

### 界面卡顿

**症状**: 接收大量数据时界面响应缓慢

**诊断步骤**:

1. **检查数据量**
   - 查看接收速率
   - 检查显示的数据行数

2. **查看资源使用**
   - 打开任务管理器/活动监视器
   - 检查 CPU 和内存使用

3. **检查自动解析**
   - 确认是否启用了自动解析
   - 检查协议复杂度

**解决方法**:

1. **限制显示行数**
   ```
   设置 → 性能设置 → 最大显示行数: 1000
   ```

2. **关闭自动滚动**
   - 在数据显示区域关闭自动滚动

3. **禁用自动解析**
   - 关闭自动解析
   - 使用手动解析

4. **使用数据过滤**
   - 只显示需要的数据
   - 使用过滤器减少显示量

### 内存占用过高

**症状**: 应用内存使用持续增长

**诊断步骤**:

1. **检查会话数量**
   - 查看活动会话数
   - 检查每个会话的数据量

2. **检查数据保留**
   - 查看数据保留设置
   - 检查是否启用了自动清理

3. **监控内存使用**
   - 使用系统工具监控
   - 记录内存增长趋势

**解决方法**:

1. **清理旧数据**
   - 关闭不需要的会话
   - 清空数据显示区域
   - 导出后删除旧数据

2. **启用自动清理**
   ```
   设置 → 存储设置 → 自动清理
   设置清理阈值（如 10000 条）
   ```

3. **减小缓冲区**
   ```
   设置 → 性能设置 → 接收缓冲区大小
   ```

4. **重启应用**
   - 定期重启应用释放内存

## 数据问题

### 数据显示乱码

**症状**: 接收的数据显示为乱码或不可读字符

**诊断步骤**:

1. **检查数据类型**
   - 确认是文本还是二进制数据
   - 查看原始十六进制

2. **检查编码**
   - 确认字符编码设置
   - 尝试不同的编码

3. **检查协议**
   - 确认协议定义正确
   - 检查字段编码设置

**解决方法**:

1. **切换显示格式**
   - 对于二进制数据，使用十六进制显示
   - 对于文本数据，选择正确的编码

2. **应用协议解析**
   - 使用协议解析查看结构化数据
   - 检查解析后的字段值

3. **调整编码设置**
   - 尝试 UTF-8、GBK、ASCII 等编码
   - 在协议定义中指定正确的编码

### 数据丢失

**症状**: 部分数据没有显示或记录

**诊断步骤**:

1. **检查过滤器**
   - 确认没有启用过滤器
   - 检查过滤规则

2. **检查缓冲区**
   - 查看缓冲区设置
   - 确认缓冲区足够大

3. **检查存储设置**
   - 确认数据存储已启用
   - 检查存储位置和权限

**解决方法**:

1. **禁用过滤器**
   - 清除所有过滤规则
   - 显示所有数据

2. **增加缓冲区**
   ```
   设置 → 性能设置 → 接收缓冲区大小
   增加到更大的值（如 64KB）
   ```

3. **启用数据存储**
   - 确保数据存储功能已启用
   - 检查存储路径可写

## 插件问题

### 插件无法加载

**症状**: 导入插件后无法加载或使用

**诊断步骤**:

1. **检查插件格式**
   - 确认是有效的 .kkpplug 文件
   - 检查 manifest.toml 格式

2. **检查权限**
   - 查看插件请求的权限
   - 确认是否授权

3. **查看错误日志**
   - 检查插件加载日志
   - 查看详细错误信息

**解决方法**:

1. **重新导入插件**
   - 删除插件
   - 重新导入

2. **检查兼容性**
   - 确认插件版本兼容
   - 查看插件的最低版本要求

3. **联系插件作者**
   - 报告问题
   - 请求更新

## 日志和诊断

### 启用调试日志

```bash
# 设置环境变量启用详细日志
# Windows (PowerShell)
$env:RUST_LOG="debug"
$env:PROTO_TOOL_DEBUG="1"

# Linux/macOS
export RUST_LOG=debug
export PROTO_TOOL_DEBUG=1
```

### 日志位置

- **Windows**: `%APPDATA%\ProtoTool\logs\`
- **macOS**: `~/Library/Application Support/ProtoTool/logs/`
- **Linux**: `~/.config/ProtoTool/logs/`

### 收集诊断信息

提交 Issue 时，请包含：

1. **系统信息**
   - 操作系统和版本
   - ProtoTool 版本

2. **错误日志**
   - 相关的日志文件
   - 错误堆栈跟踪

3. **重现步骤**
   - 详细的操作步骤
   - 预期行为和实际行为

4. **配置信息**
   - 相关的配置设置
   - 协议文件（如果相关）

## 获取帮助

如果问题仍未解决：

1. **查看 FAQ**: [[FAQ]]
2. **搜索 Issues**: [GitHub Issues](https://github.com/chenqi92/keke-proto-tool/issues)
3. **提问**: [Discussions](https://github.com/chenqi92/keke-proto-tool/discussions)
4. **报告 Bug**: [New Issue](https://github.com/chenqi92/keke-proto-tool/issues/new)

---

**相关页面**: [[FAQ]] | [[User Guide|User-Guide]] | [[Protocol Troubleshooting|Protocol-Troubleshooting]]

